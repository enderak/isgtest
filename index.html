<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒ∞SG Sƒ±nav Sim√ºlat√∂r√º - Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .explanation-box { animation: slideDown 0.4s ease-out forwards; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-100 p-4">

    <div id="quiz-app" class="max-w-2xl mx-auto mt-6"></div>

    <script>
        // --- SINAV PROFƒ∞LLERƒ∞ (Barajlar) ---
        const examProfiles = {
            igu: { id: 'igu', name: 'A-B-C Sƒ±nƒ±fƒ± ƒ∞GU', passScore: 70, color: 'text-blue-600', bg: 'bg-blue-100' },
            hekim: { id: 'hekim', name: 'ƒ∞≈üyeri Hekimliƒüi', passScore: 70, color: 'text-emerald-600', bg: 'bg-emerald-100' },
            dsp: { id: 'dsp', name: 'Diƒüer Saƒülƒ±k Personeli', passScore: 60, color: 'text-purple-600', bg: 'bg-purple-100' }
        };

        // --- SORU HAVUZU (source eklendi: 2022, 2023, deneme) ---
        const questionPool = [
          // --- DENEME SINAVI SORULARI (√ñZEL) ---
          { 
            question: "Elle ta≈üƒ±ma i≈üleri y√∂netmeliƒüine g√∂re, a≈üaƒüƒ±dakilerden hangisi y√ºkle ilgili risk fakt√∂rlerinden biri deƒüildir?", 
            options: ["Y√ºk√ºn √ßok aƒüƒ±r olmasƒ±", "Y√ºk√ºn kaba olmasƒ±", "Zeminin d√ºzg√ºn olmasƒ±", "Y√ºk√ºn dengesiz olmasƒ±"], 
            correct: 2, 
            category: "Fiziksel Riskler",
            source: "deneme",
            explanation: "Zeminin d√ºzg√ºn olmasƒ± bir risk deƒüil, aksine g√ºvenli ta≈üƒ±ma i√ßin istenen bir durumdur. Diƒüer ≈üƒ±klar riski artƒ±rƒ±r."
          },
          { 
            question: "Yapƒ± i≈ülerinde iskelelerin periyodik kontrol√º azami ne kadar s√ºrede bir yapƒ±lmalƒ±dƒ±r?", 
            options: ["3 ay", "6 ay", "1 yƒ±l", "Her kullanƒ±m √∂ncesi"], 
            correct: 1, 
            category: "Yapƒ± ƒ∞≈üleri",
            source: "deneme",
            explanation: "Yapƒ± ƒ∞≈ülerinde ƒ∞≈ü Saƒülƒ±ƒüƒ± ve G√ºvenliƒüi Y√∂netmeliƒüi'ne g√∂re iskelelerin kontrol√º en ge√ß 6 ayda bir yapƒ±lmalƒ±dƒ±r."
          },
          { 
            question: "Ta≈üƒ±nabilir yangƒ±n s√∂nd√ºrme cihazlarƒ±nƒ±n (YSC) duvara montaj y√ºksekliƒüi zeminden en fazla ka√ß cm olmalƒ±dƒ±r?", 
            options: ["90 cm", "120 cm", "150 cm", "180 cm"], 
            correct: 0, 
            category: "Yangƒ±n",
            source: "deneme",
            explanation: "4 kg ve daha aƒüƒ±r olanlar 90 cm, daha hafif olanlar ise ula≈üƒ±labilir bir y√ºksekliƒüe (genelde 90 cm standardƒ± kabul g√∂r√ºr) asƒ±lmalƒ±dƒ±r."
          },
          { 
            question: "A≈üaƒüƒ±dakilerden hangisi 'Biyolojik Risk Etmenleri' y√∂netmeliƒüine g√∂re Grup 3 biyolojik etken tanƒ±mƒ±dƒ±r?", 
            options: ["ƒ∞nsanda hastalƒ±ƒüa yol a√ßmaz", "Hastalƒ±ƒüa yol a√ßar, tedavisi yoktur, topluma yayƒ±lƒ±r", "Aƒüƒ±r hastalƒ±ƒüa yol a√ßar, yayƒ±lma riski vardƒ±r, tedavisi vardƒ±r", "Hastalƒ±ƒüa yol a√ßar, yayƒ±lma riski yoktur"], 
            correct: 2, 
            category: "Saƒülƒ±k",
            source: "deneme",
            explanation: "Grup 3: ƒ∞nsanda aƒüƒ±r hastalƒ±ƒüa neden olan, √ßalƒ±≈üanlar i√ßin ciddi tehlike olu≈üturan, topluma yayƒ±lma riski bulunabilen ancak etkili korunma ve tedavisi bulunan etkenlerdir."
          },
          { 
            question: "Ekranlƒ± ara√ßlarla √ßalƒ±≈ümalarda, √ßalƒ±≈üanlarƒ±n g√∂z saƒülƒ±ƒüƒ±nƒ± korumak i√ßin hangisi yapƒ±lmalƒ±dƒ±r?", 
            options: ["Ekran parlaklƒ±ƒüƒ± maksimuma getirilmeli", "Monit√∂r g√∂ze 10 cm mesafede olmalƒ±", "D√ºzenli molalar veya i≈ü deƒüi≈üimi yapƒ±lmalƒ±", "Ortam tamamen karanlƒ±k olmalƒ±"], 
            correct: 2, 
            category: "Ekranlƒ± Ara√ßlar",
            source: "deneme",
            explanation: "G√∂z yorgunluƒüunu √∂nlemek i√ßin √ßalƒ±≈üma s√ºreleri d√ºzenlenmeli, periyodik molalar verilmeli veya g√∂zleri dinlendirecek ba≈üka i≈üler yapƒ±lmalƒ±dƒ±r."
          },

          // --- √áIKMI≈û SORULAR (Sƒ∞M√úLASYON VERƒ∞Sƒ∞ - source: 2022, 2023 vb.) ---
          { 
            question: "4857 sayƒ±lƒ± ƒ∞≈ü Kanunu'na g√∂re, deneme s√ºresi toplu i≈ü s√∂zle≈ümeleriyle en √ßok ne kadar olabilir?", 
            options: ["2 ay", "3 ay", "4 ay", "6 ay"], 
            correct: 2, category: "Mevzuat", source: "2023",
            explanation: "Bireysel s√∂zle≈ümelerde 2 ay, toplu s√∂zle≈ümelerde 4 aydƒ±r."
          },
          { question: "ƒ∞≈ü s√∂zle≈ümesi feshedilen i≈ü√ßiye bildirim s√ºresinde yeni i≈ü arama izni g√ºnde en az ka√ß saattir?", options: ["1 saat", "2 saat", "3 saat", "4 saat"], correct: 1, category: "Mevzuat", source: "2022" },
          { question: "6331 sayƒ±lƒ± Kanun'a g√∂re kayƒ±tlar ne kadar saklanƒ±r?", options: ["10 yƒ±l", "15 yƒ±l", "20 yƒ±l", "S√ºresiz"], correct: 1, category: "Mevzuat", source: "2023" },
          { question: "Haftalƒ±k √ßalƒ±≈üma s√ºresi en fazla ka√ß saattir?", options: ["40", "45", "48", "50"], correct: 1, category: "Mevzuat", source: "2022" },
          { question: "Gece s√ºresi hangi saatler arasƒ±nƒ± kapsar?", options: ["20:00 - 06:00", "18:00 - 06:00", "20:00 - 08:00", "19:00 - 07:00"], correct: 0, category: "Mevzuat", source: "2023" },
          { question: "√áocuk i≈ü√ßilerin √ßalƒ±≈ütƒ±rƒ±lamayacaƒüƒ± i≈üler hangi ya≈üƒ± kapsar?", options: ["14", "15", "18", "21"], correct: 2, category: "Gen√ß √áalƒ±≈üanlar", source: "2022" },
          { question: "ƒ∞dari para cezalarƒ±na itiraz s√ºresi ka√ß g√ºnd√ºr?", options: ["7", "15", "30", "60"], correct: 2, category: "Hukuk", source: "2023" },
          { question: "ƒ∞SG kurulu en az ka√ß √ßalƒ±≈üanda zorunludur?", options: ["20", "30", "40", "50"], correct: 3, category: "Organizasyon", source: "2022" },
          { question: "Tehlikeli sƒ±nƒ±fta kurul ne sƒ±klƒ±kla toplanƒ±r?", options: ["Ayda 1", "2 ayda 1", "3 ayda 1", "6 ayda 1"], correct: 1, category: "Organizasyon", source: "2023" },
          { question: "Az tehlikeli sƒ±nƒ±fta risk analizi ka√ß yƒ±lda bir?", options: ["2", "4", "6", "8"], correct: 2, category: "Risk", source: "2022" },
          { question: "G√ºr√ºlt√ºde en y√ºksek maruziyet eylem deƒüeri?", options: ["80", "85", "87", "90"], correct: 1, category: "Fiziksel", source: "2023" },
          { question: "G√ºr√ºlt√º maruziyet sƒ±nƒ±r deƒüeri?", options: ["80", "85", "87", "140"], correct: 2, category: "Fiziksel", source: "2022" },
          { question: "C sƒ±nƒ±fƒ± uzman hangi sƒ±nƒ±fa bakabilir?", options: ["√áok Tehlikeli", "Tehlikeli", "Az Tehlikeli", "Hepsi"], correct: 2, category: "Mevzuat", source: "2023" },
          { question: "KKD ne zaman kullanƒ±lƒ±r?", options: ["ƒ∞lk sƒ±rada", "Toplu koruma yetersizse", "Ucuzsa", "ƒ∞stenirse"], correct: 1, category: "KKD", source: "2022" }
        ];

        // --- DEƒûƒ∞≈ûKENLER ---
        let activeQuestions = []; 
        let currentQuestion = 0;
        let score = 0;
        let showResult = false;
        let gameStarted = false;
        let userAnswers = [];
        let timeLeft = 0; 
        let timerInterval = null;

        let settings = {
            timerEnabled: false,
            instantFeedback: true,
            showExplanation: true, 
            totalTime: 75 * 60,
            profile: 'igu',
            source: 'all' // all, 2022, 2023, deneme
        };

        const app = document.getElementById('quiz-app');

        // --- FONKSƒ∞YONLAR ---
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s < 10 ? '0' : ''}${s}`;
        }

        // --- 1. START EKRANI ---
        function renderStartScreen() {
            setTimeout(() => lucide.createIcons(), 0);
            const totalQ = questionPool.length;

            app.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-lg mx-auto fade-in border border-gray-100">
                    <div class="text-center mb-6">
                        <div class="inline-block p-3 rounded-full bg-blue-50 mb-3">
                            <i data-lucide="book-open-check" class="w-12 h-12 text-blue-600"></i>
                        </div>
                        <h1 class="text-3xl font-extrabold text-gray-800 tracking-tight">ƒ∞SG Sƒ±nav Sim√ºlat√∂r√º</h1>
                    </div>

                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div class="col-span-2 md:col-span-1">
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1 ml-1">Sƒ±nav Bran≈üƒ±</label>
                                <select id="profileSelect" class="w-full p-2.5 rounded-lg border border-gray-300 bg-gray-50 text-gray-700 font-semibold focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                                    <option value="igu">ƒ∞GU (A-B-C)</option>
                                    <option value="hekim">ƒ∞≈üyeri Hekimliƒüi</option>
                                    <option value="dsp">Diƒüer Saƒülƒ±k Pers.</option>
                                </select>
                            </div>

                            <div class="col-span-2 md:col-span-1">
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1 ml-1">Soru Kaynaƒüƒ±</label>
                                <select id="sourceSelect" class="w-full p-2.5 rounded-lg border border-gray-300 bg-gray-50 text-gray-700 font-semibold focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                                    <option value="all">üìö T√ºm Yƒ±llar (Karma)</option>
                                    <option value="2023">üìÖ 2023 √áƒ±kmƒ±≈ü Sorular</option>
                                    <option value="2022">üìÖ 2022 √áƒ±kmƒ±≈ü Sorular</option>
                                    <option value="deneme" class="font-bold text-blue-700">‚≠ê Deneme Sƒ±navƒ±</option>
                                </select>
                            </div>
                        </div>

                        <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm space-y-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="timer" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-sm font-medium text-gray-700">S√ºre (75 dk)</span>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="timerToggle" checked class="sr-only peer">
                                    <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="eye" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-sm font-medium text-gray-700">Anlƒ±k Cevap</span>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="feedbackToggle" checked class="sr-only peer" onchange="toggleExplanationOption()">
                                    <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>

                            <div id="explanationOptionContainer" class="flex items-center justify-between transition-opacity duration-300">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="book-open" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-sm font-medium text-gray-700">√á√∂z√ºm√º G√∂ster</span>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="explanationToggle" checked class="sr-only peer">
                                    <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <button onclick="startQuiz()" class="w-full mt-6 bg-gray-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-black transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 flex items-center justify-center gap-2">
                        <i data-lucide="play" class="w-5 h-5"></i>
                        Sƒ±navƒ± Ba≈ülat
                    </button>
                    <p class="text-center text-xs text-gray-400 mt-3">Toplam soru havuzu: ${totalQ} adet</p>
                </div>
            `;
        }

        function toggleExplanationOption() {
            const feedbackOn = document.getElementById('feedbackToggle').checked;
            const expContainer = document.getElementById('explanationOptionContainer');
            const expInput = document.getElementById('explanationToggle');
            
            if (!feedbackOn) {
                expContainer.classList.add('opacity-50', 'pointer-events-none');
                expInput.checked = false;
            } else {
                expContainer.classList.remove('opacity-50', 'pointer-events-none');
                expInput.checked = true;
            }
        }

        // --- SINAV BA≈ûLATMA MANTIƒûI ---
        function startQuiz() {
            settings.timerEnabled = document.getElementById('timerToggle').checked;
            settings.instantFeedback = document.getElementById('feedbackToggle').checked;
            settings.showExplanation = document.getElementById('explanationToggle').checked;
            settings.profile = document.getElementById('profileSelect').value;
            settings.source = document.getElementById('sourceSelect').value; // Se√ßilen Kaynak
            
            // --- SORU Fƒ∞LTRELEME ---
            let filteredQuestions = [];
            
            if (settings.source === 'all') {
                // Deneme sorularƒ±nƒ± 'T√ºm Yƒ±llar' karma testine katmƒ±yoruz (veya isteƒüe baƒülƒ± katabiliriz).
                // ≈ûimdilik sadece ger√ßek √ßƒ±kmƒ±≈ü sorularƒ± (yƒ±l bazlƒ±larƒ±) alalƒ±m.
                filteredQuestions = questionPool.filter(q => q.source !== 'deneme');
            } else if (settings.source === 'deneme') {
                // Sadece deneme sorularƒ±
                filteredQuestions = questionPool.filter(q => q.source === 'deneme');
            } else {
                // Belirli bir yƒ±l (2022, 2023)
                filteredQuestions = questionPool.filter(q => q.source === settings.source);
            }

            // Eƒüer filtre sonucu soru yoksa (Hata √∂nleyici)
            if (filteredQuestions.length === 0) {
                alert("Bu kategoride hen√ºz soru eklenmemi≈ü. L√ºtfen 'T√ºm Yƒ±llar' veya 'Deneme Sƒ±navƒ±'nƒ± se√ßin.");
                return;
            }

            const shuffled = shuffleArray(filteredQuestions);
            // Maksimum 50 soru veya eldeki kadar
            const limit = shuffled.length < 50 ? shuffled.length : 50;
            activeQuestions = shuffled.slice(0, limit);

            if (settings.timerEnabled) {
                timeLeft = settings.totalTime;
                startTimer();
            }

            gameStarted = true;
            currentQuestion = 0;
            score = 0;
            userAnswers = new Array(activeQuestions.length).fill(null);
            showResult = false;
            
            render();
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    finishQuiz();
                } else {
                    const timerEl = document.getElementById('timer-display');
                    if (timerEl) timerEl.innerText = formatTime(timeLeft);
                }
            }, 1000);
        }

        function render() {
            if (!gameStarted) {
                renderStartScreen();
                return;
            }
            if (showResult) {
                renderResult();
            } else {
                renderQuestion();
            }
            lucide.createIcons();
        }

        // --- 2. SORU EKRANI ---
        function renderQuestion() {
            const q = activeQuestions[currentQuestion];
            const progress = ((currentQuestion + 1) / activeQuestions.length) * 100;
            const userAnswer = userAnswers[currentQuestion];
            const isAnswered = userAnswer !== null;
            const currentProfile = examProfiles[settings.profile];

            // Ba≈ülƒ±k Metni Ayarƒ±
            let headerTitle = currentProfile.name;
            if (settings.source === 'deneme') headerTitle += " - Deneme Sƒ±navƒ±";
            else if (settings.source !== 'all') headerTitle += ` - ${settings.source}`;

            let timerHtml = '';
            if (settings.timerEnabled) {
                const timerColor = timeLeft < 300 ? 'text-red-700 bg-red-50 border-red-200' : 'text-gray-700 bg-gray-50 border-gray-200';
                timerHtml = `
                    <div class="${timerColor} px-3 py-1.5 rounded-lg font-mono font-bold flex items-center gap-2 border text-sm">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        <span id="timer-display">${formatTime(timeLeft)}</span>
                    </div>
                `;
            }

            let optionsHtml = '';
            q.options.forEach((option, index) => {
                let buttonClass = "w-full p-4 text-left rounded-xl border-2 transition-all duration-200 flex items-center justify-between mb-3 group relative overflow-hidden ";
                let iconHtml = '';

                if (!isAnswered) {
                    buttonClass += "border-gray-100 hover:border-blue-400 hover:bg-blue-50 bg-white cursor-pointer shadow-sm";
                } else {
                    if (settings.instantFeedback) {
                        if (index === q.correct) {
                            buttonClass += "border-green-500 bg-green-50";
                            iconHtml = '<i data-lucide="check-circle" class="w-6 h-6 text-green-500"></i>';
                        } else if (index === userAnswer) {
                            buttonClass += "border-red-500 bg-red-50";
                            iconHtml = '<i data-lucide="x-circle" class="w-6 h-6 text-red-500"></i>';
                        } else {
                            buttonClass += "border-gray-100 bg-gray-50 opacity-60";
                        }
                    } else {
                        if (index === userAnswer) {
                            buttonClass += "border-blue-600 bg-blue-50 ring-1 ring-blue-200";
                            iconHtml = '<i data-lucide="circle-dot" class="w-6 h-6 text-blue-600"></i>';
                        } else {
                            buttonClass += "border-gray-100 bg-gray-50 opacity-60";
                        }
                    }
                }

                const onClickAttr = !isAnswered ? `onclick="handleAnswer(${index})"` : '';

                optionsHtml += `
                    <button ${onClickAttr} class="${buttonClass}">
                        <span class="font-medium text-gray-800 z-10">${option}</span>
                        ${iconHtml}
                    </button>
                `;
            });

            let explanationHtml = '';
            if (isAnswered && settings.instantFeedback && settings.showExplanation) {
                const expText = q.explanation ? q.explanation : "Bu soru i√ßin detaylƒ± a√ßƒ±klama eklenmemi≈ütir.";
                explanationHtml = `
                    <div class="explanation-box mt-4 mb-2 p-4 bg-indigo-50 border-l-4 border-indigo-500 rounded-r-xl">
                        <div class="flex items-start gap-3">
                            <i data-lucide="info" class="w-5 h-5 text-indigo-600 mt-0.5 flex-shrink-0"></i>
                            <div>
                                <h4 class="font-bold text-indigo-900 text-xs uppercase tracking-wider mb-1">Bilgi Notu</h4>
                                <p class="text-indigo-800 text-sm leading-relaxed">${expText}</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            let actionButtonHtml = '';
            if (isAnswered) {
                const isLast = currentQuestion + 1 === activeQuestions.length;
                actionButtonHtml = `
                    <button onclick="${isLast ? 'finishQuiz()' : 'nextQuestion()'}" class="w-full mt-4 bg-gray-800 text-white py-3.5 rounded-xl font-bold text-lg hover:bg-black transition-all shadow-md flex justify-center gap-2 items-center">
                        ${isLast ? 'Sƒ±navƒ± Bitir' : 'Sonraki Soru'}
                        <i data-lucide="${isLast ? 'flag' : 'arrow-right'}" class="w-5 h-5"></i>
                    </button>
                `;
            }

            app.innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden min-h-[600px] flex flex-col fade-in border border-gray-100">
                    <div class="bg-white border-b border-gray-100 p-5 flex items-center justify-between sticky top-0 z-20">
                        <div class="flex items-center gap-3">
                            <div class="${currentProfile.bg} p-2 rounded-lg">
                                <i data-lucide="book-open" class="w-5 h-5 ${currentProfile.color}"></i>
                            </div>
                            <div>
                                <h1 class="text-sm font-bold text-gray-900 leading-tight">${headerTitle}</h1>
                                <div class="flex gap-2 text-[10px] mt-0.5">
                                    <span class="text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded">${q.category}</span>
                                    <span class="text-gray-400 border border-gray-200 px-1.5 py-0.5 rounded uppercase">${q.source}</span>
                                </div>
                            </div>
                        </div>
                        ${timerHtml}
                    </div>

                    <div class="w-full bg-gray-100 h-1">
                        <div class="bg-blue-600 h-1 transition-all duration-300" style="width: ${progress}%"></div>
                    </div>

                    <div class="p-6 md:p-8 flex-1 flex flex-col justify-center bg-slate-50/50">
                        <div class="mb-6">
                            <span class="text-xs font-bold text-blue-600 mb-2 block tracking-wider uppercase">Soru ${currentQuestion + 1} / ${activeQuestions.length}</span>
                            <h2 class="text-xl md:text-2xl font-bold text-gray-800 leading-snug">${q.question}</h2>
                        </div>

                        <div class="space-y-2.5">
                            ${optionsHtml}
                        </div>
                        
                        ${explanationHtml}
                        ${actionButtonHtml}
                    </div>
                </div>
            `;
        }

        function handleAnswer(index) {
            userAnswers[currentQuestion] = index;
            render();
        }

        function nextQuestion() {
            if (currentQuestion + 1 < activeQuestions.length) {
                currentQuestion++;
                render();
            }
        }

        function finishQuiz() {
            clearInterval(timerInterval);
            score = 0;
            userAnswers.forEach((ans, idx) => {
                if (ans === activeQuestions[idx].correct) score++;
            });
            showResult = true;
            render();
        }

        function restartQuiz() {
            gameStarted = false;
            render();
        }

        // --- 3. SONU√á EKRANI ---
        function renderResult() {
            const totalQ = activeQuestions.length;
            const currentProfile = examProfiles[settings.profile];
            const pointsPerQuestion = 100 / totalQ; 
            const totalPoints = Math.round(score * pointsPerQuestion);
            const isPassed = totalPoints >= currentProfile.passScore;
            
            let message, colorClass, icon, iconColor;
            
            if (isPassed) {
                message = `Tebrikler! ${currentProfile.passScore} puan barajƒ±nƒ± ge√ßtin!`;
                colorClass = "text-green-600";
                icon = "award";
                iconColor = "text-yellow-500";
            } else {
                message = `${currentProfile.passScore} puan barajƒ±nƒ±n altƒ±nda kaldƒ±n.`;
                colorClass = "text-red-600";
                icon = "frown";
                iconColor = "text-red-400";
            }

            let summaryHtml = '';
            activeQuestions.forEach((q, idx) => {
                const givenAns = userAnswers[idx];
                const isCorrect = givenAns === q.correct;
                const isEmpty = givenAns === null;
                let statusClass = isCorrect ? 'border-l-4 border-l-green-500 bg-green-50/30' : (isEmpty ? 'border-l-4 border-l-gray-400 bg-gray-50' : 'border-l-4 border-l-red-500 bg-red-50/30');

                summaryHtml += `
                    <div class="p-4 rounded-lg bg-white shadow-sm border border-gray-100 ${statusClass} text-sm mb-2">
                        <span class="font-bold text-gray-800 block mb-1">Soru ${idx + 1}</span>
                        <p class="text-gray-600 mb-2">${q.question}</p>
                        <div class="flex flex-col gap-1 text-xs">
                            <div class="flex justify-between">
                                <span class="text-green-700 font-semibold">Doƒüru: ${q.options[q.correct]}</span>
                            </div>
                            ${!isCorrect ? `<span class="${isEmpty ? 'text-gray-500 italic' : 'text-red-600 font-semibold'}">Senin Cevabƒ±n: ${isEmpty ? 'Bo≈ü' : q.options[givenAns]}</span>` : ''}
                        </div>
                    </div>
                `;
            });

            app.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-3xl mx-auto fade-in">
                    <div class="text-center border-b border-gray-100 pb-6 mb-6">
                         <div class="inline-flex items-center gap-2 px-3 py-1 bg-gray-100 rounded-full text-xs font-bold text-gray-600 mb-4 uppercase tracking-wider">
                            ${currentProfile.name} 
                            <span class="text-gray-300">|</span> 
                            ${settings.source === 'all' ? 'Genel Tekrar' : settings.source}
                        </div>
                        <div class="flex justify-center mb-4">
                            <i data-lucide="${icon}" class="w-16 h-16 ${iconColor}"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-1">Sƒ±nav Tamamlandƒ±</h2>
                        <p class="font-medium ${colorClass}">${message}</p>
                        
                        <div class="grid grid-cols-3 gap-3 mt-6">
                            <div class="bg-blue-50 p-3 rounded-xl border border-blue-100">
                                <p class="text-blue-600 text-[10px] font-bold uppercase tracking-wider">Doƒüru</p>
                                <p class="text-2xl font-bold text-blue-900">${score}</p>
                            </div>
                            <div class="bg-indigo-50 p-3 rounded-xl border border-indigo-100">
                                <p class="text-indigo-600 text-[10px] font-bold uppercase tracking-wider">Puan</p>
                                <p class="text-2xl font-bold text-indigo-900">${totalPoints}</p>
                            </div>
                            <div class="bg-red-50 p-3 rounded-xl border border-red-100">
                                <p class="text-red-500 text-[10px] font-bold uppercase tracking-wider">Yanlƒ±≈ü/Bo≈ü</p>
                                <p class="text-2xl font-bold text-red-900">${totalQ - score}</p>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-sm font-bold text-gray-800 mb-3 flex items-center gap-2">
                            <i data-lucide="list-checks" class="w-4 h-4"></i>
                            Cevap Anahtarƒ±
                        </h3>
                        <div class="h-80 overflow-y-auto pr-2 custom-scrollbar space-y-2">
                            ${summaryHtml}
                        </div>
                    </div>

                    <button onclick="restartQuiz()" class="w-full bg-gray-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-black transition-all shadow-lg flex items-center justify-center gap-2">
                        <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                        Yeni Sƒ±nav Ba≈ülat
                    </button>
                </div>
            `;
            lucide.createIcons();
        }

        render();
    </script>
</body>
</html>
