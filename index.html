<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İSG Sınav Simülatörü - Ultra Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-100 to-indigo-50 p-3 md:p-6 text-gray-800">

    <div id="quiz-app" class="max-w-3xl mx-auto mt-4"></div>

    <script>
        // --- AYARLAR VE VERİLER ---
        const examProfiles = {
            igu: { id: 'igu', name: 'A-B-C Sınıfı İGU', passScore: 70, color: 'text-blue-600', bg: 'bg-blue-100', border: 'border-blue-200' },
            hekim: { id: 'hekim', name: 'İşyeri Hekimliği', passScore: 70, color: 'text-emerald-600', bg: 'bg-emerald-100', border: 'border-emerald-200' },
            dsp: { id: 'dsp', name: 'Diğer Sağlık Pers.', passScore: 60, color: 'text-purple-600', bg: 'bg-purple-100', border: 'border-purple-200' }
        };

        const questionPool = [
            // --- DENEME SORULARI ---
            { 
                question: "Elle taşıma işleri yönetmeliğine göre, aşağıdakilerden hangisi yükle ilgili risk faktörlerinden biri değildir?", 
                options: ["Yükün çok ağır olması", "Yükün kaba olması", "Zeminin düzgün olması", "Yükün dengesiz olması"], 
                correct: 2, category: "Fiziksel Riskler", source: "deneme",
                explanation: "Zeminin düzgün olması güvenli taşıma için istenen bir durumdur, risk değildir."
            },
            { 
                question: "Yapı işlerinde iskelelerin periyodik kontrolü azami ne kadar sürede bir yapılmalıdır?", 
                options: ["3 ay", "6 ay", "1 yıl", "Her kullanım öncesi"], 
                correct: 1, category: "Yapı İşleri", source: "deneme",
                explanation: "Yönetmeliğe göre iskele kontrolleri en geç 6 ayda bir yapılır."
            },
            { 
                question: "Taşınabilir yangın söndürme cihazlarının (YSC) duvara montaj yüksekliği zeminden en fazla kaç cm olmalıdır?", 
                options: ["90 cm", "120 cm", "150 cm", "180 cm"], 
                correct: 0, category: "Yangın", source: "deneme",
                explanation: "Genel kabul gören standart ve yönetmeliklere göre 90 cm ulaşılabilir yüksekliktir."
            },
            { 
                question: "Biyolojik Risk Etmenleri yönetmeliğine göre Grup 3 biyolojik etken tanımı hangisidir?", 
                options: ["Hastalığa yol açmaz", "Tedavisi yoktur, topluma yayılır", "Ağır hastalık yapar, yayılma riski vardır, tedavisi vardır", "Hastalık yapar, yayılma riski yoktur"], 
                correct: 2, category: "Sağlık", source: "deneme",
                explanation: "Grup 3: Ağır hastalık, çalışan için ciddi tehlike, topluma yayılma riski var, ancak tedavisi var."
            },
            { 
                question: "Ekranlı araçlarla çalışmalarda göz sağlığı için hangisi önerilir?", 
                options: ["Parlaklık en sonda olmalı", "Monitör çok yakında olmalı", "Düzenli molalar verilmeli", "Ortam karanlık olmalı"], 
                correct: 2, category: "Ekranlı Araçlar", source: "deneme",
                explanation: "Göz yorgunluğunu önlemek için periyodik dinlenme araları verilmelidir."
            },
            // --- ÇIKMIŞ SORULAR ÖRNEKLERİ ---
            { question: "4857 sayılı İş Kanunu'na göre deneme süresi toplu sözleşmeyle en çok kaç aydır?", options: ["2 ay", "3 ay", "4 ay", "6 ay"], correct: 2, category: "Mevzuat", source: "2023" },
            { question: "İş sözleşmesi feshedilen işçiye iş arama izni günde en az kaç saattir?", options: ["1 saat", "2 saat", "3 saat", "4 saat"], correct: 1, category: "Mevzuat", source: "2022" },
            { question: "6331 sayılı Kanun'a göre kayıtlar ne kadar saklanır?", options: ["10 yıl", "15 yıl", "20 yıl", "Süresiz"], correct: 1, category: "Mevzuat", source: "2023" },
            { question: "Haftalık çalışma süresi en fazla kaç saattir?", options: ["40", "45", "48", "50"], correct: 1, category: "Mevzuat", source: "2022" },
            { question: "Gece süresi hangi saatler arasını kapsar?", options: ["20:00 - 06:00", "18:00 - 06:00", "20:00 - 08:00", "19:00 - 07:00"], correct: 0, category: "Mevzuat", source: "2023" },
            { question: "İSG kurulu en az kaç çalışanda zorunludur?", options: ["20", "30", "40", "50"], correct: 3, category: "Organizasyon", source: "2022" },
            { question: "Gürültüde en yüksek maruziyet eylem değeri kaçtır?", options: ["80", "85", "87", "90"], correct: 1, category: "Fiziksel", source: "2023" }
        ];

        // --- DURUM DEĞİŞKENLERİ ---
        let activeQuestions = [];
        let currentQuestion = 0;
        let score = 0;
        let showResult = false;
        let gameStarted = false;
        let userAnswers = []; // null veya index
        let timeLeft = 0;
        let timerInterval = null;

        let settings = {
            timerEnabled: false,
            instantFeedback: false, // Varsayılan kapalı olsun ki ileri geri rahat yapılsın
            showExplanation: true,
            totalTime: 75 * 60,
            profile: 'igu',
            source: 'all'
        };

        const app = document.getElementById('quiz-app');

        // --- YARDIMCI FONKSİYONLAR ---
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s < 10 ? '0' : ''}${s}`;
        }

        // --- 1. GİRİŞ EKRANI ---
        function renderStartScreen() {
            setTimeout(() => lucide.createIcons(), 0);
            const totalQ = questionPool.length;

            app.innerHTML = `
                <div class="bg-white rounded-3xl shadow-xl p-8 max-w-lg mx-auto fade-in border border-slate-100">
                    <div class="text-center mb-8">
                        <div class="inline-flex items-center justify-center w-20 h-20 bg-indigo-50 rounded-full mb-4 ring-8 ring-indigo-50/50">
                            <i data-lucide="brain-circuit" class="w-10 h-10 text-indigo-600"></i>
                        </div>
                        <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight">İSG Sınav Simülatörü</h1>
                        <p class="text-gray-500 text-sm mt-2">Sınav Modu & Çalışma Modu</p>
                    </div>

                    <div class="space-y-5">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1.5 ml-1">Branş</label>
                                <div class="relative">
                                    <select id="profileSelect" class="w-full pl-3 pr-8 py-3 rounded-xl border border-gray-200 bg-gray-50 text-gray-700 font-semibold focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none appearance-none transition-all">
                                        <option value="igu">İGU (A-B-C)</option>
                                        <option value="hekim">İşyeri Hekimliği</option>
                                        <option value="dsp">Diğer Sağlık P.</option>
                                    </select>
                                    <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400 absolute right-3 top-3.5 pointer-events-none"></i>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1.5 ml-1">Kaynak</label>
                                <div class="relative">
                                    <select id="sourceSelect" class="w-full pl-3 pr-8 py-3 rounded-xl border border-gray-200 bg-gray-50 text-gray-700 font-semibold focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none appearance-none transition-all">
                                        <option value="all">Genel Karma</option>
                                        <option value="2023">2023 Soruları</option>
                                        <option value="2022">2022 Soruları</option>
                                        <option value="deneme">Deneme Sınavı</option>
                                    </select>
                                    <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400 absolute right-3 top-3.5 pointer-events-none"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-slate-50 p-5 rounded-2xl border border-slate-200 space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="bg-white p-2 rounded-lg shadow-sm text-gray-600"><i data-lucide="timer" class="w-5 h-5"></i></div>
                                    <span class="text-sm font-semibold text-gray-700">Süre Tut (75 dk)</span>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="timerToggle" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="bg-white p-2 rounded-lg shadow-sm text-gray-600"><i data-lucide="zap" class="w-5 h-5"></i></div>
                                    <div>
                                        <span class="text-sm font-semibold text-gray-700 block">Anlık Cevap</span>
                                        <span class="text-[10px] text-gray-400 leading-tight">İşaretleyince cevabı göster</span>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="feedbackToggle" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <button onclick="startQuiz()" class="group w-full mt-8 bg-gray-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-black transition-all shadow-xl hover:shadow-2xl hover:-translate-y-1 flex items-center justify-center gap-3">
                        <span>Sınavı Başlat</span>
                        <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                    </button>
                    <p class="text-center text-xs text-gray-400 mt-4">Havuzda toplam ${totalQ} soru bulunmaktadır.</p>
                </div>
            `;
        }

        // --- SINAV MANTIĞI ---
        function startQuiz() {
            settings.timerEnabled = document.getElementById('timerToggle').checked;
            settings.instantFeedback = document.getElementById('feedbackToggle').checked;
            settings.profile = document.getElementById('profileSelect').value;
            settings.source = document.getElementById('sourceSelect').value;

            // Soru Filtreleme
            let filteredQuestions = [];
            if (settings.source === 'all') filteredQuestions = questionPool.filter(q => q.source !== 'deneme');
            else if (settings.source === 'deneme') filteredQuestions = questionPool.filter(q => q.source === 'deneme');
            else filteredQuestions = questionPool.filter(q => q.source === settings.source);

            if (filteredQuestions.length === 0) {
                alert("Bu kategoride soru bulunamadı.");
                return;
            }

            const shuffled = shuffleArray(filteredQuestions);
            const limit = shuffled.length < 50 ? shuffled.length : 50;
            activeQuestions = shuffled.slice(0, limit);

            if (settings.timerEnabled) {
                timeLeft = settings.totalTime;
                startTimer();
            }

            gameStarted = true;
            currentQuestion = 0;
            userAnswers = new Array(activeQuestions.length).fill(null);
            showResult = false;
            
            render();
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    finishQuiz();
                } else {
                    const timerEl = document.getElementById('timer-display');
                    if (timerEl) timerEl.innerText = formatTime(timeLeft);
                }
            }, 1000);
        }

        // --- 2. SORU EKRANI (RENDER) ---
        function render() {
            if (!gameStarted) { renderStartScreen(); return; }
            if (showResult) { renderResult(); return; }

            const q = activeQuestions[currentQuestion];
            const userAnswer = userAnswers[currentQuestion];
            const isAnswered = userAnswer !== null;
            const currentProfile = examProfiles[settings.profile];
            const isLocked = settings.instantFeedback && isAnswered; // Anlık cevap açıksa ve cevaplandıysa kilitli

            // Zamanlayıcı HTML
            let timerHtml = '';
            if (settings.timerEnabled) {
                const isLow = timeLeft < 300;
                timerHtml = `
                    <div class="${isLow ? 'bg-red-50 text-red-600 border-red-200' : 'bg-gray-50 text-gray-700 border-gray-200'} px-3 py-1.5 rounded-lg border font-mono font-bold text-sm flex items-center gap-2">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        <span id="timer-display">${formatTime(timeLeft)}</span>
                    </div>`;
            }

            // Şıklar HTML
            let optionsHtml = '';
            q.options.forEach((option, index) => {
                let btnClass = "w-full p-4 text-left rounded-xl border-2 transition-all duration-200 flex items-center justify-between mb-3 group relative ";
                let iconHtml = '<i data-lucide="circle" class="w-5 h-5 text-gray-300"></i>';

                // Stil Mantığı
                if (!isAnswered) {
                    // Henüz cevaplanmadı
                    btnClass += "border-gray-100 bg-white hover:border-indigo-300 hover:bg-indigo-50 cursor-pointer";
                } else {
                    // Cevaplandı
                    if (settings.instantFeedback) {
                        // Anlık Cevap AÇIK: Doğru/Yanlış hemen göster
                        if (index === q.correct) {
                            btnClass += "border-green-500 bg-green-50";
                            iconHtml = '<i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>';
                        } else if (index === userAnswer) {
                            btnClass += "border-red-500 bg-red-50";
                            iconHtml = '<i data-lucide="x-circle" class="w-6 h-6 text-red-500"></i>';
                        } else {
                            btnClass += "border-gray-100 bg-white opacity-50";
                        }
                    } else {
                        // Anlık Cevap KAPALI: Sadece seçimi göster (Mavi)
                        if (index === userAnswer) {
                            btnClass += "border-blue-600 bg-blue-50 ring-1 ring-blue-200";
                            iconHtml = '<i data-lucide="check-circle" class="w-6 h-6 text-blue-600"></i>';
                        } else {
                            btnClass += "border-gray-100 bg-white opacity-80";
                        }
                    }
                }

                // Tıklama Engeli (Locked)
                const clickAction = isLocked ? '' : `onclick="handleAnswer(${index})"`;
                if(isLocked) btnClass += " cursor-default";

                optionsHtml += `
                    <button ${clickAction} class="${btnClass}">
                        <span class="font-medium text-gray-800 text-sm md:text-base">${option}</span>
                        ${iconHtml}
                    </button>
                `;
            });

            // Açıklama Kutusu (Sadece Anlık Cevap Açıksa ve Cevaplanmışsa)
            let explanationHtml = '';
            if (isAnswered && settings.instantFeedback && q.explanation) {
                explanationHtml = `
                    <div class="mt-4 p-4 bg-indigo-50 border border-indigo-100 rounded-xl fade-in">
                        <div class="flex gap-2 items-start">
                            <i data-lucide="info" class="w-5 h-5 text-indigo-600 mt-0.5 flex-shrink-0"></i>
                            <p class="text-indigo-900 text-sm">${q.explanation}</p>
                        </div>
                    </div>`;
            }

            // --- NAVİGASYON BUTONLARI ---
            const isFirst = currentQuestion === 0;
            const isLast = currentQuestion === activeQuestions.length - 1;
            
            // "Cevabı Temizle" butonu (Sadece cevap varsa ve anlık cevap kapalıysa gösterilir)
            const showClearBtn = isAnswered && !settings.instantFeedback;

            const navigationHtml = `
                <div class="flex items-center justify-between mt-6 gap-3">
                    <button onclick="prevQuestion()" ${isFirst ? 'disabled' : ''} class="px-5 py-3 rounded-xl font-bold text-gray-600 bg-gray-100 hover:bg-gray-200 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center gap-2">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i> <span class="hidden md:inline">Önceki</span>
                    </button>

                    ${showClearBtn ? `
                        <button onclick="clearAnswer()" class="px-4 py-2 text-xs font-bold text-red-500 hover:text-red-700 bg-red-50 hover:bg-red-100 rounded-lg transition-colors border border-red-100">
                            Temizle / Boş Bırak
                        </button>
                    ` : '<div></div>'}

                    ${isLast ? 
                        `<button onclick="finishQuiz()" class="px-6 py-3 rounded-xl font-bold text-white bg-gray-900 hover:bg-black shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                            Sınavı Bitir <i data-lucide="flag" class="w-4 h-4"></i>
                        </button>` 
                        : 
                        `<button onclick="nextQuestion()" class="px-6 py-3 rounded-xl font-bold text-white bg-indigo-600 hover:bg-indigo-700 shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                            Sonraki <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>`
                    }
                </div>
            `;

            // --- SORU GEZGİNİ (NAVIGATOR) ---
            let navigatorHtml = '<div class="grid grid-cols-10 gap-2 mt-8 pt-6 border-t border-gray-100">';
            activeQuestions.forEach((_, idx) => {
                let navClass = "h-8 md:h-10 rounded-lg text-xs font-bold flex items-center justify-center transition-all ";
                const isNavCurrent = idx === currentQuestion;
                const isNavAnswered = userAnswers[idx] !== null;

                if (isNavCurrent) {
                    navClass += "bg-gray-800 text-white ring-2 ring-gray-300 scale-110 z-10";
                } else if (isNavAnswered) {
                    navClass += "bg-blue-100 text-blue-700 border border-blue-200 hover:bg-blue-200";
                } else {
                    navClass += "bg-gray-50 text-gray-400 border border-gray-100 hover:bg-gray-100";
                }

                navigatorHtml += `<button onclick="jumpToQuestion(${idx})" class="${navClass}">${idx + 1}</button>`;
            });
            navigatorHtml += '</div>';


            // Ana Render HTML
            app.innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden min-h-[600px] flex flex-col fade-in border border-gray-100 relative">
                    <div class="bg-white border-b border-gray-100 p-4 md:p-6 flex items-center justify-between sticky top-0 z-20">
                        <div class="flex items-center gap-3">
                            <div class="${currentProfile.bg} p-2 rounded-lg">
                                <i data-lucide="book-open" class="w-5 h-5 ${currentProfile.color}"></i>
                            </div>
                            <div>
                                <h1 class="text-sm font-bold text-gray-900 leading-tight">${currentProfile.name}</h1>
                                <span class="text-xs text-gray-400 font-medium">${settings.source.toUpperCase()}</span>
                            </div>
                        </div>
                        ${timerHtml}
                    </div>

                    <div class="w-full bg-gray-100 h-1">
                        <div class="bg-indigo-600 h-1 transition-all duration-300" style="width: ${((currentQuestion + 1) / activeQuestions.length) * 100}%"></div>
                    </div>

                    <div class="p-4 md:p-8 flex-1 flex flex-col justify-center bg-slate-50/30">
                        <div class="mb-6">
                            <div class="flex justify-between items-start">
                                <span class="text-xs font-bold text-indigo-600 mb-2 block tracking-wider uppercase">Soru ${currentQuestion + 1}</span>
                                <span class="text-[10px] bg-gray-100 text-gray-500 px-2 py-1 rounded">${q.category}</span>
                            </div>
                            <h2 class="text-lg md:text-xl font-bold text-gray-800 leading-snug">${q.question}</h2>
                        </div>

                        <div class="space-y-2.5">
                            ${optionsHtml}
                        </div>
                        
                        ${explanationHtml}
                        ${navigationHtml}
                        ${navigatorHtml}
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        // --- AKSİYONLAR ---
        function handleAnswer(index) {
            // Eğer anlık cevap açıksa ve zaten cevaplanmışsa değiştirme (Kilitli)
            if (settings.instantFeedback && userAnswers[currentQuestion] !== null) return;
            
            userAnswers[currentQuestion] = index;
            render();
        }

        function clearAnswer() {
            if (settings.instantFeedback) return; // Anlık cevapta temizleme olmaz
            userAnswers[currentQuestion] = null;
            render();
        }

        function nextQuestion() {
            if (currentQuestion + 1 < activeQuestions.length) {
                currentQuestion++;
                render();
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                render();
            }
        }

        function jumpToQuestion(index) {
            currentQuestion = index;
            render();
        }

        function finishQuiz() {
            // İsteğe bağlı: Boş soru kontrolü uyarısı eklenebilir
            clearInterval(timerInterval);
            score = 0;
            userAnswers.forEach((ans, idx) => {
                if (ans === activeQuestions[idx].correct) score++;
            });
            showResult = true;
            render();
        }

        function restartQuiz() {
            gameStarted = false;
            render();
        }

        // --- 3. SONUÇ EKRANI ---
        function renderResult() {
            const totalQ = activeQuestions.length;
            const currentProfile = examProfiles[settings.profile];
            const pointsPerQuestion = 100 / totalQ; 
            const totalPoints = Math.round(score * pointsPerQuestion);
            const isPassed = totalPoints >= currentProfile.passScore;
            
            let message, colorClass, icon;
            
            if (isPassed) {
                message = "Tebrikler! Barajı geçtiniz.";
                colorClass = "text-green-600";
                icon = "award";
            } else {
                message = "Barajın altında kaldınız.";
                colorClass = "text-red-600";
                icon = "frown";
            }

            // Detaylı Rapor Oluşturma
            let summaryHtml = '';
            activeQuestions.forEach((q, idx) => {
                const givenAns = userAnswers[idx];
                const isCorrect = givenAns === q.correct;
                const isEmpty = givenAns === null;
                
                let borderClass = '';
                let statusBadge = '';

                if (isCorrect) {
                    borderClass = 'border-l-4 border-l-green-500 bg-green-50/20';
                    statusBadge = '<span class="text-green-600 text-xs font-bold">DOĞRU</span>';
                } else if (isEmpty) {
                    borderClass = 'border-l-4 border-l-gray-300 bg-gray-50';
                    statusBadge = '<span class="text-gray-400 text-xs font-bold">BOŞ</span>';
                } else {
                    borderClass = 'border-l-4 border-l-red-500 bg-red-50/20';
                    statusBadge = '<span class="text-red-600 text-xs font-bold">YANLIŞ</span>';
                }

                summaryHtml += `
                    <div class="p-4 rounded-lg border border-gray-100 ${borderClass} mb-3 text-sm">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-gray-700">Soru ${idx + 1}</span>
                            ${statusBadge}
                        </div>
                        <p class="text-gray-600 mb-2">${q.question}</p>
                        <div class="text-xs space-y-1">
                            <div class="flex items-center gap-2">
                                <i data-lucide="check" class="w-3 h-3 text-green-600"></i>
                                <span class="text-gray-800 font-semibold">${q.options[q.correct]}</span>
                            </div>
                            ${(!isCorrect && !isEmpty) ? `
                            <div class="flex items-center gap-2 text-red-600">
                                <i data-lucide="x" class="w-3 h-3"></i>
                                <span>Sizin Cevabınız: ${q.options[givenAns]}</span>
                            </div>` : ''}
                        </div>
                    </div>
                `;
            });

            app.innerHTML = `
                <div class="bg-white rounded-3xl shadow-xl p-8 max-w-3xl mx-auto fade-in">
                    <div class="text-center border-b border-gray-100 pb-8 mb-6">
                        <div class="inline-flex p-4 bg-gray-50 rounded-full mb-4">
                            <i data-lucide="${icon}" class="w-16 h-16 ${isPassed ? 'text-yellow-500' : 'text-gray-400'}"></i>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-900 mb-2">${isPassed ? 'BAŞARILI' : 'BAŞARISIZ'}</h2>
                        <p class="font-medium ${colorClass} mb-6 text-lg">${message}</p>
                        
                        <div class="grid grid-cols-3 gap-4">
                            <div class="bg-blue-50 p-4 rounded-2xl">
                                <span class="text-xs font-bold text-blue-400 uppercase tracking-wider block mb-1">Doğru</span>
                                <span class="text-3xl font-extrabold text-blue-900">${score}</span>
                            </div>
                             <div class="bg-gray-50 p-4 rounded-2xl">
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wider block mb-1">Yanlış/Boş</span>
                                <span class="text-3xl font-extrabold text-gray-700">${totalQ - score}</span>
                            </div>
                            <div class="bg-indigo-50 p-4 rounded-2xl border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-400 uppercase tracking-wider block mb-1">Puan</span>
                                <span class="text-3xl font-extrabold text-indigo-900">${totalPoints}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-50 rounded-xl p-1 mb-6 border border-slate-200">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider p-3 pb-1">Soru Analizi</h3>
                        <div class="h-80 overflow-y-auto custom-scrollbar px-2 pb-2">
                            ${summaryHtml}
                        </div>
                    </div>

                    <button onclick="restartQuiz()" class="w-full bg-gray-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-black transition-all shadow-lg flex items-center justify-center gap-2">
                        <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                        Yeni Sınav Başlat
                    </button>
                </div>
            `;
            lucide.createIcons();
        }

        render();
    </script>
</body>
</html>
